@model PortfolioDetailDto
@using SGP_Freelancing.Models.DTOs;
@{
    ViewData["Title"] = Model.Title;
}

<div class="container-fluid p-0">
    <!-- Cover Section -->
    <div class="position-relative" style="height: 300px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); overflow: hidden;">
        @if (!string.IsNullOrEmpty(Model.CoverImageUrl))
        {
            <img src="@Model.CoverImageUrl" alt="Cover" class="w-100 h-100" style="object-fit: cover;">
        }
        else
        {
            <div class="w-100 h-100 d-flex align-items-center justify-content-center">
                <i class="fa fa-image fa-5x text-white opacity-25"></i>
            </div>
        }
    </div>
</div>

<div class="container my-5">
    <div class="row">
        <!-- Profile Section -->
        <div class="col-lg-3">
            <div class="card shadow-sm position-sticky" style="top: 20px;">
                <!-- Profile Image -->
                <div class="text-center pt-4">
                    @if (!string.IsNullOrEmpty(Model.FreelancerImage))
                    {
                        <img src="@Model.FreelancerImage" alt="Profile" class="rounded-circle" style="width: 150px; height: 150px; object-fit: cover; border: 4px solid #667eea;">
                    }
                    else
                    {
                        <div class="rounded-circle mx-auto bg-light d-flex align-items-center justify-content-center" style="width: 150px; height: 150px;">
                            <i class="fa fa-user fa-3x text-muted"></i>
                        </div>
                    }
                </div>

                <!-- Profile Info -->
                <div class="card-body text-center">
                    <h5 class="fw-bold">@Model.FreelancerName</h5>
                    <p class="text-muted mb-3">@Model.FreelancerTitle</p>

                    <!-- Rating -->
                    <div class="mb-3">
                        @for (int i = 0; i < (int)Model.FreelancerRating; i++)
                        {
                            <i class="fa fa-star text-warning"></i>
                        }
                        @if (Model.FreelancerRating % 1 > 0)
                        {
                            <i class="fa fa-star-half-alt text-warning"></i>
                        }
                        <div class="small text-muted mt-1">@Model.FreelancerRating.ToString("F1") Rating</div>
                    </div>

                    <!-- Stats -->
                    <div class="row text-center">
                        <div class="col-6 mb-3">
                            <div class="h5 fw-bold text-primary">@Model.Cases.Count</div>
                            <div class="small text-muted">Case Studies</div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="h5 fw-bold text-success">@Model.Testimonials.Count</div>
                            <div class="small text-muted">Testimonials</div>
                        </div>
                    </div>

                    <hr>
                    <button type="button" class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#contactModal">
                        <i class="fa fa-envelope me-2"></i> Contact Freelancer
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-lg-9">
            <!-- Portfolio Title & Description -->
            <div class="mb-5">
                <h2 class="display-6 fw-bold mb-3">@Model.Title</h2>
                @if (!string.IsNullOrEmpty(Model.Description))
                {
                    <p class="lead text-muted mb-3">@Model.Description</p>
                }
                @if (!string.IsNullOrEmpty(Model.DetailedBio))
                {
                    <p>@Html.Raw(Model.DetailedBio)</p>
                }
            </div>

            <!-- Case Studies Section -->
            @if (Model.Cases != null && Model.Cases.Count > 0)
            {
                <div class="mb-5">
                    <h3 class="fs-4 fw-bold mb-4">
                        <i class="fa fa-briefcase text-primary me-2"></i> Case Studies
                    </h3>

                    <div class="row g-4">
                        @foreach (var portfolioCase in Model.Cases)
                        {
                            <div class="col-md-6">
                                <div class="card h-100 shadow-sm hover-shadow">
                                    <!-- Case Thumbnail -->
                                    <div style="height: 200px; background: #f8f9fa; overflow: hidden;">
                                        @if (!string.IsNullOrEmpty(portfolioCase.ThumbnailUrl))
                                        {
                                            <img src="@portfolioCase.ThumbnailUrl" alt="@portfolioCase.Title" class="w-100 h-100" style="object-fit: cover;">
                                        }
                                        else
                                        {
                                            <div class="w-100 h-100 d-flex align-items-center justify-content-center">
                                                <i class="fa fa-image fa-3x text-muted"></i>
                                            </div>
                                        }
                                    </div>

                                    <div class="card-body">
                                        <h5 class="card-title fw-bold">@portfolioCase.Title</h5>
                                        @if (!string.IsNullOrEmpty(portfolioCase.ClientName))
                                        {
                                            <p class="card-text small text-muted mb-2">
                                                <i class="fa fa-building me-1"></i> @portfolioCase.ClientName
                                            </p>
                                        }

                                        @if (!string.IsNullOrEmpty(portfolioCase.Description))
                                        {
                                            <p class="card-text text-muted">@portfolioCase.Description</p>
                                        }

                                        <!-- Case Info -->
                                        <div class="small text-muted mb-3">
                                            @if (portfolioCase.BudgetAmount.HasValue)
                                            {
                                                <div><i class="fa fa-dollar-sign me-1"></i> @portfolioCase.BudgetAmount.Value.ToString("F2") @portfolioCase.BudgetCurrency</div>
                                            }
                                            @if (portfolioCase.CompletionDate.HasValue)
                                            {
                                                <div><i class="fa fa-calendar me-1"></i> @portfolioCase.CompletionDate.Value.ToString("MMM yyyy")</div>
                                            }
                                            @if (portfolioCase.Rating.HasValue)
                                            {
                                                <div>
                                                    <i class="fa fa-star text-warning me-1"></i>
                                                    @for (int i = 0; i < (int)portfolioCase.Rating.Value; i++)
                                                    {
                                                        <i class="fa fa-star text-warning"></i>
                                                    }
                                                </div>
                                            }
                                        </div>

                                        @if (!string.IsNullOrEmpty(portfolioCase.ProjectUrl))
                                        {
                                            <a href="@portfolioCase.ProjectUrl" target="_blank" rel="noopener noreferrer" class="btn btn-sm btn-outline-primary">
                                                <i class="fa fa-external-link-alt me-1"></i> View Project
                                            </a>
                                        }
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }

            <!-- Testimonials Section -->
            @if (Model.Testimonials != null && Model.Testimonials.Count > 0)
            {
                <div class="mb-5">
                    <h3 class="fs-4 fw-bold mb-4">
                        <i class="fa fa-quote-left text-primary me-2"></i> Client Testimonials
                    </h3>

                    <div class="row g-4">
                        @foreach (var testimonial in Model.Testimonials.OrderByDescending(t => t.TestimonialDate).Take(3))
                        {
                            <div class="col-md-6">
                                <div class="card shadow-sm">
                                    <div class="card-body">
                                        <!-- Stars -->
                                        <div class="mb-3">
                                            @for (int i = 0; i < (int)testimonial.Rating; i++)
                                            {
                                                <i class="fa fa-star text-warning"></i>
                                            }
                                            @if (testimonial.Rating % 1 > 0)
                                            {
                                                <i class="fa fa-star-half-alt text-warning"></i>
                                            }
                                        </div>

                                        <!-- Testimonial Content -->
                                        <p class="card-text">@testimonial.Content</p>

                                        <!-- Client Info -->
                                        <div class="pt-3 border-top">
                                            <p class="mb-0 fw-bold">@(testimonial.IsAnonymous ? "Anonymous Client" : testimonial.ClientName)</p>
                                            @if (!string.IsNullOrEmpty(testimonial.ClientCompany))
                                            {
                                                <p class="small text-muted mb-0">@testimonial.ClientCompany</p>
                                            }
                                            @if (testimonial.TestimonialDate.HasValue)
                                            {
                                                <p class="small text-muted mb-0">@testimonial.TestimonialDate.Value.ToString("MMMM yyyy")</p>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>

                    @if (Model.Testimonials.Count > 3)
                    {
                        <div class="text-center mt-4">
                            <button type="button" class="btn btn-outline-primary" data-bs-toggle="collapse" data-bs-target="#allTestimonials">
                                See All @Model.Testimonials.Count Testimonials
                            </button>
                        </div>

                        <div class="collapse mt-4" id="allTestimonials">
                            <div class="row g-4">
                                @foreach (var testimonial in Model.Testimonials.Skip(3))
                                {
                                    <div class="col-md-6">
                                        <div class="card shadow-sm">
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    @for (int i = 0; i < (int)testimonial.Rating; i++)
                                                    {
                                                        <i class="fa fa-star text-warning"></i>
                                                    }
                                                </div>
                                                <p class="card-text">@testimonial.Content</p>
                                                <div class="pt-3 border-top">
                                                    <p class="mb-0 fw-bold">@(testimonial.IsAnonymous ? "Anonymous" : testimonial.ClientName)</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    }
                </div>
            }

            <!-- Stats -->
            <div class="bg-light p-4 rounded-3">
                <h5 class="fw-bold mb-3">Portfolio Stats</h5>
                <div class="row text-center">
                    <div class="col-4">
                        <div class="h4 fw-bold text-primary">@Model.ViewCount</div>
                        <div class="small text-muted">Views</div>
                    </div>
                    <div class="col-4">
                        <div class="h4 fw-bold text-success">@Model.Cases.Count</div>
                        <div class="small text-muted">Projects</div>
                    </div>
                    <div class="col-4">
                        <div class="h4 fw-bold text-info">@Model.Testimonials.Count</div>
                        <div class="small text-muted">Reviews</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Contact Modal -->
<div class="modal fade" id="contactModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Contact @Model.FreelancerName</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label class="form-label">Subject</label>
                        <input type="text" class="form-control" placeholder="Project inquiry">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Message</label>
                        <textarea class="form-control" rows="4" placeholder="Your message..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary">Send Message</button>
            </div>
        </div>
    </div>
</div>

<style>
    .hover-shadow {
        transition: box-shadow 0.3s ease, transform 0.3s ease;
    }

    .hover-shadow:hover {
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15) !important;
        transform: translateY(-5px);
    }
</style>
